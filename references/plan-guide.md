# Plan 编写指南

Plan 是迭代计划文档，定义"这次要做什么"。

## 核心原则

### 1. 短生命周期

Plan 是"用完即归档"的文档。

- 创建 → 执行 → 完成 → 归档
- 一个 plan 通常对应 1-2 周的工作量
- 完成后加 `archived-` 前缀

### 2. 可执行性

Plan 中的任务应该是明确可执行的。

**好的任务**：实现搜索 API 端点
**不好的任务**：优化搜索功能（太模糊）

### 3. 范围可控

每个 plan 的范围应该足够小。

- 宁可多创建几个 plan
- 也不要一个 plan 塞太多任务
- MVP 优先

---

## 文档结构

### 1. 目标（必须）

本次迭代要达成什么。

```markdown
## 1. 目标 (Objectives)

- **Infra**: 完成 Nuxt 4 + SQLite 基础环境搭建
- **Feature**: 实现 Prompt 的 CRUD 与版本管理
- **Feature**: 实现基础的 RunLog 记录与展示
```

### 2. 涉及的模块（必须）

本次迭代涉及哪些功能模块。

```markdown
## 2. 涉及的模块

- `business/prompt/spec-prompt-assets.md` - 实现 1.1 和 1.2 部分
- `business/test/spec-test-framework.md` - 实现基础运行功能
```

### 3. 约束（必须）

必须遵守的规则。

```markdown
## 3. 约束 (Constraints)

- **System**: 严格遵循 `tech/xxx/README.md` 的技术规范
- **UI**: 暂不追求极致美观，优先保证功能可用性
- **Scope**: 暂不实现 1ToN 测试和 Workflow 集成
```

### 4. 任务清单（必须）

具体要做的事。

```markdown
## 4. 任务清单 (Tasks)

### 4.1 基础设施
- [ ] 初始化 Nuxt 4 项目
- [ ] 配置 SQLite 连接
- [ ] 封装统一错误处理

### 4.2 提示词管理
- [ ] 实现 Prompt 列表页
- [ ] 实现 Prompt 详情页
- [ ] 实现版本管理
```

### 5. 风险（必须）

可能的问题和应对。

```markdown
## 5. 风险 (Risks)

- **LLM 稳定性**: 准备 Mock 数据，防止 API 波动影响调试
- **时间估计**: 版本管理可能比预期复杂，必要时简化
```

### 6. 验收标准（可选但推荐）

本次迭代完成的标志。

```markdown
## 6. 验收标准

- [ ] 能创建、编辑、删除 Prompt
- [ ] 每次保存自动生成新版本
- [ ] 能运行测试并查看日志
```

---

## 版本号规范

```
v{major}.{minor}-{name}.md
```

- **major**: 大版本，通常对应里程碑
- **minor**: 小版本，递增
- **name**: 本次迭代的核心主题

**示例**：
```
v0.1-init.md          # 初始化
v0.2-search.md        # 搜索功能
v0.3-auth.md          # 认证功能
v1.0-release.md       # 正式发布
```

---

## 归档规范

完成后移动文件到 archive/ 目录：

```bash
# 进行中
_adoc/plan/v0.2-search.md

# 归档后
_adoc/plan/archive/v0.2-search.md
```

归档步骤：
1. 所有任务都标记为完成（`- [x]`）
2. 文档同步检查完成
3. 询问用户该 Plan 属于哪个模块
4. 更新 `_adoc/plan/index.md`（在对应模块下添加记录）
5. 移动文件到 `archive/` 目录

归档条件：
- 所有任务都标记为完成（`- [x]`）
- 用户确认可以归档

---

## 任务拆分原则

### 粒度判断

**太大**：
- 任务描述超过一行
- 完成需要超过 1 天
- 包含多个独立步骤

**太小**：
- 5 分钟内能完成
- 过于琐碎（如"创建文件夹"）

**合适**：
- 2-4 小时可完成
- 一个明确的可交付物
- 可独立验证

### 任务分组

按阶段或模块分组：

```markdown
### 基础设施
- [ ] ...

### 功能开发
- [ ] ...

### 测试验证
- [ ] ...
```

---

## 与业务模块的关系

### Plan 引用业务模块

Plan 中的任务应该对应业务模块中的能力：

```markdown
## 涉及的模块

- `business/prompt/spec-prompt-assets.md`
  - 实现 "1. 提示词定义" 部分
  - 实现 "2.1 分组" 功能
```

### Plan 不重复 Spec

Plan 不需要重复 Spec 中的详细描述，只需要：
- 引用 Spec
- 说明本次实现哪些部分

---

## 常见问题

### Q: 一个 Plan 应该包含多少任务？

A: 通常 5-15 个任务。太少说明粒度太粗，太多说明范围太大。

### Q: Plan 执行到一半想加任务怎么办？

A:
1. 讨论是否真的需要
2. 如果需要，更新 Plan 文档
3. 不要私自增加范围

### Q: Plan 中的任务做不完怎么办？

A:
1. 标记未完成的任务
2. 讨论是否继续当前 Plan
3. 或者归档当前 Plan，创建新 Plan

### Q: 需要同时进行多个 Plan 吗？

A: 不建议。专注一个 Plan，完成后再开始下一个。

---

## 模板参考

参见 `@templates/plan.md`
