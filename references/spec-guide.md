# Spec 编写指南

Spec 是功能模块文档，描述"产品具备什么能力"。

## 核心原则

### 1. 模块化

每个 spec 文件 = 一个独立的产品能力。

**判断标准**：
- 这个能力可以单独交付吗？
- 这个能力有独立的用户价值吗？

### 2. 低耦合

模块之间尽量减少依赖。

**如果依赖过多**：
- 考虑合并成一个模块
- 或重新划分边界

### 3. 面向用户

Spec 描述的是"用户能做什么"，不是"系统怎么实现"。

**好的写法**：用户可以创建 Prompt 并保存为新版本
**不好的写法**：调用 POST /api/prompt 接口，数据存入 SQLite

---

## 文档结构

### 1. 核心能力（必须）

一句话描述这个模块的价值。

```markdown
> **核心能力**：将提示词从"文本片段"升级为"工程化资产"，
> 提供结构化定义、版本控制与组织管理能力。
```

### 2. 概念定义（必须）

描述这个模块涉及的核心概念。

```markdown
## 1. 提示词定义 (Prompt Definition)

### 1.1 结构化构成
- **Input Schema**: 定义 Prompt 接受的变量清单
  - *价值*：自动生成测试表单，明确调用契约
- **Prompt Body**: 基于角色的对话流配置
  - *价值*：支持复杂的 Chat 结构
```

### 3. 用户旅程（必须）

描述用户如何使用这个功能。

```markdown
## 3. 关键用户旅程

### Journey: 创建新提示词
1. 用户点击"新建"，输入名称并选择分组
2. 在编辑器中定义 Input Variables
3. 编写 Prompt Body，引用变量
4. 保存，系统自动生成 v1 版本

### Journey: 版本迭代
1. 用户打开现有 Prompt，进入编辑模式
2. 修改 System Role 指令
3. 保存，系统生成 v2 版本并展示 Diff
```

### 4. 验收标准（必须）

怎么算"做完了"。

```markdown
## 4. 验收标准

- [ ] 编辑器支持变量高亮与自动补全
- [ ] 切换版本时编辑器内容无缝刷新
- [ ] Diff 视图能清晰展示变更
- [ ] 分组导航能准确过滤列表
```

### 5. 依赖关系（必须）

与其他模块的关系。

```markdown
## 5. 依赖关系

- **依赖**：无
- **被依赖**：02_test_framework, 03_data_loop
```

---

## 命名规范

### 文件命名

```
{序号}_{功能名}.md
```

- 序号：两位数字，表示建议实现顺序
- 功能名：小写字母，下划线分隔

**示例**：
```
01_prompt_assets.md
02_test_framework.md
03_data_loop.md
```

### 标题命名

```markdown
# Product Spec: {功能名称}
```

功能名称应该：
- 简洁（2-4 个词）
- 面向用户（不是技术术语）
- 体现核心价值

---

## 粒度判断

### 太大的信号

- 一个 spec 超过 3 页
- 包含多个独立的用户旅程
- "核心能力"需要用"和"连接多个能力

**解决**：拆分成多个 spec

### 太小的信号

- 不能独立交付
- 必须和另一个模块一起才有意义
- 验收标准只有 1-2 条

**解决**：合并到相关 spec

### 合适的粒度

- 一个明确的核心能力
- 2-5 个相关的用户旅程
- 4-8 条验收标准
- 1-2 页内容

---

## 常见问题

### Q: Spec 需要写技术方案吗？

A: 不需要。技术方案放到 `system/` 里。Spec 只描述"用户能做什么"。

### Q: 如何处理跨模块的功能？

A:
1. 确定主要归属（哪个模块的核心价值）
2. 在相关模块的"依赖关系"中标注
3. 如果经常跨模块，考虑重新划分边界

### Q: Spec 需要更新吗？

A: 需要。当：
- 功能增强 → 更新 spec
- 功能移除 → 归档 spec（加 archived- 前缀）
- 需求变更 → 更新 spec

### Q: 验收标准写多细？

A: 粒度要适中：
- **太粗**：用户能管理 Prompt（无法验证）
- **太细**：点击按钮后 200ms 内响应（过于技术化）
- **合适**：编辑器支持变量高亮与自动补全（可验证、面向用户）

---

## 模板参考

参见 `@templates/spec.md`
